<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
    content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/styles/style.css">
    <title>Plataforma de Gerenciamento de Investimentos | Home</title>
</head>
<body>
    <header>
        <div>
            <img src="/static/img/logo.png" alt="logo">
            <center>
                <h2>Todos os investimentos</h2>
            </center>
        </div>
    </header>

    <main>
        <section>
            <div class='ticker'>
                <img id="ticker-img" src="">
                <div>
                    <a href="/">Voltar</a>
                    <h3>Ticker:             <span id="tk">{{ ticker }}</span></h3>
                    <h3>Total:         <span id="qt">---------</span></h3>
                </div>
            </div>
        </section>

        <section id="all">
            <div class="table">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Data</th>
                            <th>Quant. ações</th>
                            <th>Valor</th>
                            <th>Tipo</th>
                            <th>Taxa de corretagem</th>
                            <th>Valor operacional</th>
                            <th>Imposto</th>
                            <th>Valor Final</th>
                            <th>Preço médio</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="../static/utils.js"></script>
	<script src="../static/api.js"></script>
	<script src="../static/database.js"></script>
	<script src="../static/script.js"></script>
	<script src="../static/investimento_utils.js"></script>

    <script>
        async function carregarTickers() {
            ticker = document.querySelector('#tk')
            investimentos = (await obterInvestimentos()).filter(i => i.ticker.cod == ticker.innerText)

            investimentos.reverse()

            investimentos_ajustados = ajustarPrecoMedio(investimentos)
            document.querySelector('#qt').innerText = investimentos.length

            document.querySelector('#ticker-img').setAttribute('src', investimentos[0].ticker.logo_url)
            
            var table_body = table.querySelector('tbody')

            investimentos.forEach(i => {
                var linha = table_body.insertRow();
                linha.setAttribute('inv-id', i.id)

                // Adiciona as células na nova linha
                var celId = linha.insertCell();
                var celData = linha.insertCell();
                var celQuantidade = linha.insertCell();
                var celValorAcao = linha.insertCell();
                var celTipo = linha.insertCell();
                var celTaxa = linha.insertCell();
                var celValorOp = linha.insertCell();
                var celImposto = linha.insertCell();
                var celValorFinal = linha.insertCell();
                var celPM = linha.insertCell();
                var celStatus = linha.insertCell();

                console.log(i)

                celId.innerHTML = i.id
                celData.innerHTML = i.data
                celQuantidade.innerHTML = i.quantidade
                celValorAcao.innerHTML = format(i.valor_unit)
                celTipo.innerHTML = i.tipo
                celTaxa.innerHTML = format(i.taxa_corretagem)
                celValorOp.innerHTML = format(i.valor_op)
                celImposto.innerHTML = format(i.imposto)
                celValorFinal.innerHTML = format(i.valor_final)
                celPM.innerHTML = format(i.preco_medio)
                celStatus.innerHTML = i.lucro ? 'Lucro' : 'Prejuízo'
            })
        }

        carregarTickers()
    </script>
</body>
</html>